# ACP Mobile - MVP

[![License](https://img.shields.io/badge/license-Internal-red.svg)](LICENSE)
[![Version](https://img.shields.io/badge/version-0.1.0-blue.svg)](CHANGELOG.md)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-blue)](https://www.typescriptlang.org/)
[![React Native](https://img.shields.io/badge/React_Native-0.81.5-61dafb)](https://reactnative.dev/)
[![Expo](https://img.shields.io/badge/Expo-~54.0-000020)](https://expo.dev/)

Mobile companion app for the Ambient Code Platform (ACP).

## Features (MVP - Phase 1-3 + Real-time Updates)

âœ… **User Story 1: Monitor Active AI Sessions**

- View dashboard with active sessions
- See session status, progress, and model information
- Navigate to detailed session view
- **Real-time progress updates via Server-Sent Events (SSE)**
- Error indicators for failed sessions
- Offline support with cached data
- **Connection status indicator with retry capability**

## Tech Stack

- **Framework**: React Native 0.81.5 + Expo SDK 54
- **Language**: TypeScript 5.x
- **Routing**: Expo Router (file-based)
- **State Management**: React Context + TanStack Query
- **Storage**: Expo SecureStore + AsyncStorage
- **Auth**: OAuth 2.0 + PKCE (prepared for Red Hat SSO)
- **Performance**: Comprehensive monitoring suite (dev only)

## Performance Monitoring

The app includes **comprehensive performance monitoring** in development mode:

- ðŸ“Š **Visual Dashboard** - Tap the ðŸ“Š button for real-time metrics
- ðŸ’¾ **Memory Tracking** - Detect memory leaks and high usage
- ðŸŽ¬ **FPS Monitoring** - Track frame rate and UI jank
- ðŸ”„ **Render Tracking** - Identify unnecessary re-renders
- ðŸ“ˆ **React Query DevTools** - Monitor cache and network activity

**Quick Access**:

```typescript
// In development console
performance.report() // Full performance report
```

See [Performance Monitoring Guide](docs/performance/monitoring.md) for complete documentation.

## Quick Start

```bash
npm install && npm start
```

**Run on device:**

- **iOS**: `npm run ios`
- **Android**: `npm run android`
- **Physical device**: Scan QR code with Expo Go app

See [Setup Guide](docs/getting-started/setup.md) for detailed installation instructions.

### Development Mode

The app currently uses **mock data** for testing without a backend:

- Mock sessions are defined in `utils/mockData.ts`
- Mock SSE events are generated by `MockSSEService` in `utils/mockData.ts`
- To switch to real API:
  - Set `USE_MOCK_DATA = false` in `hooks/useSessions.ts`
  - Set `USE_MOCK_SSE = false` in `hooks/useRealtimeSession.ts`
- API configuration is in `utils/constants.ts`

**Mock SSE Behavior:**

- Generates random session update events every 10-15 seconds
- 60% progress updates, 25% session updates, 15% status changes
- Only affects running sessions
- Simulates realistic real-time update patterns

## Project Structure

```
app/                    # Expo Router screens
â”œâ”€â”€ (tabs)/
â”‚   â””â”€â”€ index.tsx      # Dashboard
â”œâ”€â”€ sessions/
â”‚   â”œâ”€â”€ [id].tsx       # Session detail
â”‚   â””â”€â”€ index.tsx      # Sessions list
â””â”€â”€ _layout.tsx        # Root layout with providers

components/            # Reusable components
â”œâ”€â”€ session/          # Session-specific components
â”œâ”€â”€ ui/               # Base UI components
â””â”€â”€ layout/           # Layout components

services/             # Business logic
â”œâ”€â”€ api/             # API clients
â”œâ”€â”€ auth/            # Authentication
â””â”€â”€ storage/         # Data persistence

hooks/               # Custom React hooks
types/               # TypeScript types
utils/               # Utilities and constants
```

## Documentation

ðŸ“š **Comprehensive documentation is available at the [documentation site](https://ambient-code.github.io/acp-mobile)** (deployed automatically)

### Quick Links

- **Getting Started**
  - [Quick Start](docs/getting-started/quickstart.md) - Get running in 5 minutes
  - [Setup Guide](docs/getting-started/setup.md) - Complete development environment setup
  - [Troubleshooting](docs/getting-started/troubleshooting.md) - Common issues and solutions

- **Architecture & Design**
  - [Architecture Overview](docs/architecture/overview.md) - Platform architecture and integration
  - [Design System](docs/design/design-system.md) - UI/UX guidelines, colors, typography

- **Development**
  - [Contributing Guide](CONTRIBUTING.md) - How to contribute
  - [API Reference](docs/api/index.md) - TypeScript API documentation
  - [Changelog](CHANGELOG.md) - Version history

- **Project Management**
  - [Development Backlog](BACKLOG.md) - Upcoming features and improvements
  - [Security Audit](SECURITY_AUDIT_SUMMARY.md) - Security assessment and recommendations

### Serve Documentation Locally

```bash
# Install Python dependencies
pip install -r requirements-docs.txt

# Start documentation server
mkdocs serve

# Visit http://localhost:8000
```

## MVP Implementation Status

### âœ… Phase 1: Setup & Infrastructure (11 tasks)

- Project initialization
- Dependencies installed
- TypeScript configured
- Directory structure created

### âœ… Phase 2: Foundational Infrastructure (14 tasks)

- TypeScript type definitions
- OAuth PKCE authentication flow
- API client with token refresh
- AsyncStorage cache utilities
- Theme system (light/dark/system)
- Auth and Theme contexts

### âœ… Phase 3: User Story 1 - Monitor Sessions (12 tasks)

- Sessions API service
- useSessions hook with polling (replaced with SSE)
- useOffline hook
- SessionCard, SessionProgress, ModelBadge, StatusBadge components
- Header with greeting and refresh spinner
- Dashboard screen
- Session detail screen
- Sessions list screen with filters

### âœ… Phase 4: Real-time Updates (Event-Driven Architecture)

- Server-Sent Events (SSE) implementation
- Event type definitions (`types/realtime.ts`)
- `RealtimeService` with automatic reconnection and exponential backoff
- `MockSSEService` for development testing
- `useRealtimeSession` hook for SSE integration
- Direct React Query cache updates (no refetches)
- Connection state UI with retry functionality
- Support for `session.progress`, `session.updated`, and `session.status` events

## Testing the MVP

1. **Start the app**: `npm start`
2. **Open on device**: Scan QR code or run in simulator
3. **View dashboard**: See mock active sessions with real-time updates
4. **Watch live updates**: Session progress bars update every 10-15 seconds automatically
5. **Tap session**: View detailed session information
6. **View all sessions**: Use "View All" or "{N} Running" button
7. **Filter sessions**: Use filter chips (All/Running/Paused/Done)
8. **Pull to refresh**: Test manual refresh functionality
9. **Connection status**: If mock SSE disabled, see connection state indicator
10. **Test reconnection**: When error state, tap "Retry" button

## Next Steps

The following features are planned:

- **Phase 5**: User Story 2 - Review Completed Work
- **Phase 6**: User Story 3 - GitHub Notifications
- **Phase 7**: User Story 4 - Interactive Chat
- **Phase 8**: User Story 5 - Create New Sessions
- **Phase 9**: User Story 6 - Settings & Preferences

## Backend Integration

To connect to the real ACP backend:

1. Update `API_BASE_URL` in `utils/constants.ts`
2. Configure OAuth client ID and redirect URI
3. Set `USE_MOCK_DATA = false` in `hooks/useSessions.ts`
4. Set `USE_MOCK_SSE = false` in `hooks/useRealtimeSession.ts`
5. Ensure backend endpoints match `services/api/*.ts`
6. Implement SSE endpoint at `${API_BASE_URL}/sse/sessions` with event types:
   - `session.progress` - Progress updates
   - `session.updated` - Incremental session changes
   - `session.status` - Status transitions

## Troubleshooting

**App won't start**:

```bash
npx expo start -c  # Clear cache
```

**Type errors**:

```bash
npm run lint  # Check for issues
```

**Can't find module errors**:

```bash
npm install  # Reinstall dependencies
```

## Contributing

This is an MVP implementation. See `specs/001-acp-mobile/` for full specifications, planning documents, and task breakdown.

## License

Internal Red Hat project.
